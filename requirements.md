# 黑场切割助手 (Black Frame Detector) 需求文档 (重构版)

## 1. 项目背景
现有的基于重度“Task（任务）”的交互设计过于割裂和繁琐，需要简化操作步骤，让用户只关注于“选视频 -> 调切点 -> 拿结果”。

## 2. 核心交互重构设计

以“一镜到底”的沉浸式体验为原则，优化所有繁琐步骤：

### 2.1 极简的文件目录管理
*   **无需层层建文件夹**：放弃原有的 `Config & Logs`，`Artifacts` 等深层嵌套结构。
*   **产物平铺**：配置好唯一的一个**默认输出目录 (Default Directory)** 后，切割出的视频直接保存在 `<默认目录>/<原视频名称>_输出/` 下，切点数据 (JSON) 则隐式保存在 VS Code 的 `globalState` 或单层隐藏配置里，做到**对用户透明、无打扰**。

### 2.2 自动无缝的流式操作
用户核心路径缩短为三步：
1.  **第一步（加入）**：点击侧边栏 `TreeView` 顶部的 `+` 图标，在弹出的文件浏览器中选择你要处理的本地源视频。
2.  **第二步（自动分析 & 展现）**：选中视频后，**直接且自动**触发 FFmpeg 黑场扫描。并在 VS Code 底部弹出 Progress 进度条。扫描完成后，**自动弹出全屏的 Webview 切点编辑器**面板，无需用户任何额外点击。
3.  **第三步（确认并输出）**：在 Webview 中核对无误后，点击“确认并切割”按钮，后台静默切割，由于切点精准，产物瞬间出炉，并给一个弹窗提示“切分完毕，点击查看文件夹”。

### 2.3 “一点即开”的轻量级 TreeView 侧边栏
*   **一级节点（源视频）**：展示曾经处理过（或未切分完）的视频文件名。**单击该节点，立刻重新打开对应的 Webview 切点面板**。
*   **二级节点（切割产物）**：如果该视频已经切分完毕，展开后列表显示 `片段1.mp4`, `片段2.mp4` 等产物。**单击产物，直接在操作系统的 Finder/资源管理器 中高亮该文件**。
*   **右键菜单**：提供简单的“从列表中移除”、“在本地打开源文件”等轻量操作。

### 2.4 更丝滑的 Webview 截断点编辑器
不仅要展示前后 `1s` 的预览图，由于时间戳往往需要微调，所以增强微调能力：
*   **快速步进微调**：在时间戳输入框附近，增加 `+0.1s` / `-0.1s` / `+0.5s` / `-0.5s` 的快捷按钮。
*   **实时刷新**：一旦用户点击时间微调按钮或者修改了输入框的值，立即自动去后台调用 FFmpeg 截取该时刻的新预览图，并在前端实现局部图片刷新（做到“所点即所得”）。
*   **极简添加**：支持在时间轴任意处精准增加自定义切点，并自动截取该处的预览图。

## 3. 非功能需求
*   需要全局安装 `ffmpeg`。
*   使用 VS Code Webview UI Toolkit 规范界面样式，确保在任何主题下都美观。
*   FFmpeg 的一切复杂指令执行在后台做到静默化、平滑化处理，仅通过标准的 VS Code Progress API 通知用户。
