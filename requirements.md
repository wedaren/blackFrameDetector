# 黑场切割助手 (Black Frame Detector) 需求文档 (重构版)

## 1. 项目背景
现有的基于重度“Task（任务）”的交互设计过于割裂和繁琐，需要简化操作步骤，让用户只关注于“选视频 -> 调切点 -> 拿结果”。

## 2. 核心交互重构设计

以“一镜到底”的沉浸式体验为原则，优化所有繁琐步骤：

### 2.1 极简的文件目录管理 (File System Persistence)
*   **无需层层建文件夹**：放弃原有的 `Config & Logs` 等复杂结构。
*   **配置一次，全部平铺**：配置好唯一的**默认输出目录 (Default Directory)** 后，每次添加新视频都会生成一个专属的 `原视频名称_Hash` 文件夹。
*   **零缓存干扰**：剪辑配置 (`task.json`)、动图缓存、输出切片 (`splits/`) 全堆在这一目录下管理。
*   **自清洁特性**：您只要在操作系统的文件管理器中直接把这个文件夹删掉，VS Code 侧边树（TreeView）里也会随之干干净净消失，真正做到了对用户的机器绿色便携开发。

### 2.2 自动无缝的流式操作
用户核心路径缩短为三步：
1.  **第一步（加入）**：点击侧边栏 `TreeView` 顶部的 `+` 图标，在弹出的文件浏览器中选择你要处理的本地源视频。
2.  **第二步（自动分析）**：选中视频后，**直接且自动**触发 FFmpeg 黑场扫描。全系统静默处理：不再抛出任何打扰注意力的弹出通知，仅仅通过 `TreeView` 任务节点的加载动画 (`loading~spin`) 暗示进度。
3.  **第三步（精细化展示）**：处理结束，**自动弹出全屏的 Webview 切点编辑器面板**，全程不需要人工参与。
4.  **第四步（确认并输出）**：在 Webview 中核对无误后，点击“确认并切割”按钮。面板自动关闭并回归 TreeView 视图，后台依然**静默切割**（出现正在切割的提示状态），切完即可前往资源管理器拿产物。

### 2.3 “一点即开”的轻量级 TreeView 侧边栏
*   **一级节点（源视频）**：展示曾经处理过（或未切分完）的视频文件名。**单击该节点，立刻重新打开对应的 Webview 切点面板**。
*   **二级节点功能（直通操作系统）**：展开包含原视频图标与 `Output Artifacts` 等成果目录。**单击这些视频类的文件时，放弃鸡肋的 VSCode 内置播放器响应，改为直接在 OS Finder (资源管理器) 中定位高亮该文件。**
*   **右键菜单**：提供了 "Reveal in OS"（本地打开源文件）、"Manage Cut Points" 和彻底斩断所有硬盘配置并删除此任务的 "Delete Task" 删除功能。

### 2.4 更丝滑的 Webview 截断点编辑器
不仅要展示前后 `1s` 的预览图，由于时间戳往往需要微调，所以增强微调能力：
*   **双轴范围微调**：拥有类似于 Premiere 裁剪片段的滑动范围选择轴，更精细化设定保留内容区间。在滑块或时间修改时，立刻重新使用后台提取新的静态图预览。
*   **智能动图连贯预览 (B站风格)**：悬停在这段区域上，自动播放通过 WebP 生成的前后短视频帧，对内容断点效果连贯性拥有“所见即所得”的审视手段，时长允许通过 `blackFrameDetector.previewDuration` 设置调节。
*   **退货按钮**：添加一键复原初始分析的 “Reset to Default” 按钮。
*   **自动避短**：拥有 `minSliceDuration` 参数拦截，凡是检测出来的初始片段小于您期待时长底限的杂乱黑边段落都会被自动忽略掉。

## 3. 非功能需求
*   需要全局安装 `ffmpeg`。
*   使用 VS Code Webview UI Toolkit 规范界面样式，确保在任何主题下都美观。
*   FFmpeg 的一切复杂指令执行在后台做到完全静默化、平滑化处理，彻底放弃进度条，通过左侧 `TreeView` 节点的状态小图标（动画 Spinner）展示目前行为的阶段暗示，提升浸入式的专注感。
